<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>systemd</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="org-default.css" />
</head>
<body>
<div id="content" class="container">
<nav aria-label="breadcrumb" style="--pico-nav-breadcrumb-divider: '|';" id="orgf158de5">
<ul class="org-ul">
<li><a href="index.html#ID-3a34d6d7-6f37-4573-b20e-3c93894e54ac">üè†</a></li>
<li><a href="site_map.html#ID-30ea5e38-9b41-4bcd-8631-76821e93e294">üó∫</a></li>
</ul>
</nav>
<div id="outline-container-org25fce13" class="outline-2">
<h2 id="org25fce13">Systemd</h2>
<div class="outline-text-2" id="text-org25fce13">
</div>
<div id="outline-container-org884d6fb" class="outline-3">
<h3 id="org884d6fb">systemd</h3>
<div class="outline-text-3" id="text-org884d6fb">
</div>
<div id="outline-container-org10c4f09" class="outline-4">
<h4 id="org10c4f09">journalctl</h4>
<div class="outline-text-4" id="text-org10c4f09">
<ul class="org-ul">
<li><code>/etc/systemd/journald.conf</code>
<ul class="org-ul">
<li><code>SystemMaxUse=100M</code></li>
</ul></li>
<li><code>journalctl -u SERVICE</code></li>
<li>previous boots dmesg log <code>journalctl -k -b -1</code></li>
<li>coredumpctl</li>
</ul>
</div>
</div>
<div id="outline-container-org13b0cc5" class="outline-4">
<h4 id="org13b0cc5">sysctl</h4>
<div class="outline-text-4" id="text-org13b0cc5">
<ul class="org-ul">
<li><code>net.ipv4.icmp_echo_ignore_all = 1</code> in <code>/etc/sysctl.conf</code> or <code>/etc/sysctl.d/90-override.conf</code> to disable icmp</li>
</ul>
</div>
</div>
<div id="outline-container-org5a23b7a" class="outline-4">
<h4 id="org5a23b7a">systemctl</h4>
<div class="outline-text-4" id="text-org5a23b7a">
</div>
<ul class="org-ul">
<li><a id="orge22fa32"></a>services<br>
<div class="outline-text-5" id="text-orge22fa32">
<ul class="org-ul">
<li><code>edit</code> doesn't require <code>daemon-reload</code></li>
<li>hooks within services like <code>ExecStartPost/ExecStopPost</code></li>
<li>list <code>systemctl list-unit-files</code></li>
<li>list failed <code>systemctl list-units --state failed</code></li>
<li>deps <code>systemctl list-dependencies --reverse</code></li>
<li>mask with <code>systemctl mask swap.target</code></li>
<li>remote management with ssh <code>systemctl --host=user@somesuchhost.com status SERVICE.unit</code></li>
<li>restart interval with <code>RestartSec=5</code></li>
<li>cron like with a <code>service.timer</code> containing a schedule like <code>OnCalendar=Sunday *-*-* 4:00:00</code> and a service with the <code>Type=oneshot</code></li>
</ul>
</div>
</li>
</ul>
</div>
<div id="outline-container-org0b5c235" class="outline-4">
<h4 id="org0b5c235">timedatectl</h4>
<div class="outline-text-4" id="text-org0b5c235">
<ul class="org-ul">
<li>systemd-timesyncd <code>timedatectl set-ntp true</code></li>
<li><code>set-local-rtc</code> to set hardware clock to localtime instead of UTC</li>
</ul>
</div>
</div>
<div id="outline-container-org327ae9e" class="outline-4">
<h4 id="org327ae9e">NetworkManager</h4>
<div class="outline-text-4" id="text-org327ae9e">
<ul class="org-ul">
<li><code>/usr/lib/NetworkManager/conf.d/20-connectivity.conf</code> pings out
<ul class="org-ul">
<li><code>/etc/NetworkManager/conf.d/20-connectivity.conf</code>
[connectivity]
uri=<a href="http://ping.manjaro.org/check_network_status.txt">http://ping.manjaro.org/check_network_status.txt</a>
interval=0
enabled=false</li>
</ul></li>
<li>conflicts with <code>systemd-networkd</code></li>
<li>configure for dnsmasq with <code>[main] dns=dnsmasq</code></li>
</ul>
</div>
</div>
<div id="outline-container-org9653ebf" class="outline-4">
<h4 id="org9653ebf">resolvectl</h4>
<div class="outline-text-4" id="text-org9653ebf">
<ul class="org-ul">
<li>dns cache
<ul class="org-ul">
<li>issue with long running process? Several weeks of uptime and lockup of dns request despite ping working&#x2026;</li>
</ul></li>
<li><code>resolvectl statistics</code> and <code>resolvectl status</code></li>
<li><code>/etc/systemd/resolved.conf</code></li>
<li>enable <code>systemd-resolved</code> and start</li>
<li><code>DNSStubListener</code> listens on 127.0.0.53 127.0.0.1.54 for udp/tcp port 53
<ul class="org-ul">
<li><code>ln -sf ../run/systemd/resolve/stub-resolv.conf /etc/resolv.conf</code>
<ul class="org-ul">
<li>alternatively configure NetworkManager with <code>[main] dns=systemd-resolved</code></li>
</ul></li>
<li>for local dnsmasq set to no, add dnsmasq/localhost to DNS servers
<ul class="org-ul">
<li>may require <code>bind-interfaces</code> for dnsmasq config (binds 127.0.0.1 port 53)</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org666d15f" class="outline-4">
<h4 id="org666d15f">misc</h4>
<div class="outline-text-4" id="text-org666d15f">
<ul class="org-ul">
<li><code>systemd-analyze blame</code> for boot times</li>
<li><code>systemd-analyze security my-service.unit</code> for sec settings</li>
<li><code>systemctl --user status</code> for services in <code>$HOME/.config/systemd/user/</code></li>
<li><code>systemctl set-default</code> or <code>isolate</code> with runlevels/targets <code>rescue</code>, <code>multi-user</code> and <code>graphical</code></li>
<li>rate limited restart will disable units with <code>Restart=on-failure</code> without <code>StartLimitIntervalSec=0</code></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
