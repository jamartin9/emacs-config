<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>bpftrace</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="org-default.css" />
</head>
<body>
<div id="content" class="container content">
<nav class="navbar is-black" id="org18aae6c">
<div class="navbar-brand" id="org7259004">
<div class="navbar-item" id="orgd4a4a99">
<p>
<a href="index.html#ID-3a34d6d7-6f37-4573-b20e-3c93894e54ac">üè†</a>
</p>

</div>

</div>
<div class="navbar-menu" id="org2e58af6">
<div class="navbar-start" id="orgc288ef4">
<div class="navbar-item" id="org2c5279e">
<p>
<a href="site_map.html#ID-30ea5e38-9b41-4bcd-8631-76821e93e294">üó∫</a>
</p>

</div>

</div>
<div class="navbar-end" id="orgf2ee948">

</div>

</div>
</nav>
<div id="outline-container-orgb3b074d" class="outline-2">
<h2 id="orgb3b074d">bpftrace</h2>
<div class="outline-text-2" id="text-orgb3b074d">
</div>
<div id="outline-container-org34e2c4c" class="outline-3">
<h3 id="org34e2c4c">notes</h3>
<div class="outline-text-3" id="text-org34e2c4c">
<ul class="org-ul">
<li>needs cap or sudo</li>
<li>&lt;EVENT&gt;/&lt;FILTER&gt;/&lt;BLOCK&gt; structure</li>
</ul>
</div>
</div>
<div id="outline-container-orgd8117a1" class="outline-3">
<h3 id="orgd8117a1">oneliners</h3>
<div class="outline-text-3" id="text-orgd8117a1">
<ul class="org-ul">
<li>tools for oneline usually installed in /usr/share/bpftrace/tools/*.bt</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh" id="org58bc0a0"># print results on internval. Add to end to poll probe
BPF_POLL='interval:s:1 { print(@); clear(@); }'
# profile pid 6969
BPF_PROFILE='profile:hz:99 /pid == 6969/ { @[ustack] = count(); }'
# cache miss counter
BPF_CACHE='hardware:cache-misses:1000000 { @[comm, pid] = count(); }'
# page misses
BPF_PAGE='software:faults:1 { @[comm] = count(); }'
# print cache misses every sec
sudo bpftrace -e "${BPF_CACHE} ${BPF_POLL}"
# print all syscalls for prog
sudo bpftrace -e 'tracepoint:syscalls:sys_enter_* /comm != "bpftrace"/ {printf("Process Name: %s Syscall Requested: %s\n", comm, probe);}'
# print tcp active connections
sudo bpftrace /usr/share/bpftrace/tools/tcpconnect.bt
# print tcp passive connections
sudo bpftrace /usr/share/bpftrace/tools/tcpaccept.bt
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>